
# Payment Validation Report

**Generated:** 2026-01-14
**Comparison:** Production (`public.stripe_invoices`) vs Analytics (`mart_stripe_payments`)

---

## Executive Summary

| Metric | Production | Analytics | Difference |
|--------|------------|-----------|------------|
| **Total Successful Payments** | 243 | 355 | -112 |
| **Total Revenue (USD)** | $3,525.21 | $4,534.52 | -$1,009.31 |
| **Date Range Start** | 2025-12-26 | 2025-11-26 | 30 days gap |
| **Date Range End** | 2026-01-14 | 2026-01-13 | 1 day lag |

**Status:** DISCREPANCY DETECTED

---

## Monthly Comparison

| Month | Prod Count | Prod USD | Analytics Count | Analytics USD | Count Diff | USD Diff |
|-------|------------|----------|-----------------|---------------|------------|----------|
| 2025-11 | 0 | $0.00 | 8 | $10.00 | -8 | -$10.00 |
| 2025-12 | 98 | $1,344.90 | 204 | $2,383.18 | -106 | -$1,038.28 |
| 2026-01 | 145 | $2,180.31 | 143 | $2,141.34 | +2 | +$38.97 |

---

## Daily Comparison

*Note: Rows marked with * indicate discrepancies*

| Date | Prod Count | Prod USD | Analytics Count | Analytics USD | Count Diff | USD Diff | Status |
|------|------------|----------|-----------------|---------------|------------|----------|--------|
| 2025-11-26 | 0 | $0.00 | 2 | $2.00 | -2 | -$2.00 | * |
| 2025-11-27 | 0 | $0.00 | 4 | $4.00 | -4 | -$4.00 | * |
| 2025-11-28 | 0 | $0.00 | 1 | $2.00 | -1 | -$2.00 | * |
| 2025-11-29 | 0 | $0.00 | 1 | $2.00 | -1 | -$2.00 | * |
| 2025-12-01 | 0 | $0.00 | 2 | $2.00 | -2 | -$2.00 | * |
| 2025-12-02 | 0 | $0.00 | 4 | $6.00 | -4 | -$6.00 | * |
| 2025-12-03 | 0 | $0.00 | 3 | $3.00 | -3 | -$3.00 | * |
| 2025-12-04 | 0 | $0.00 | 2 | $2.00 | -2 | -$2.00 | * |
| 2025-12-05 | 0 | $0.00 | 4 | $4.00 | -4 | -$4.00 | * |
| 2025-12-08 | 0 | $0.00 | 1 | $2.00 | -1 | -$2.00 | * |
| 2025-12-09 | 0 | $0.00 | 7 | $94.95 | -7 | -$94.95 | * |
| 2025-12-11 | 0 | $0.00 | 9 | $92.13 | -9 | -$92.13 | * |
| 2025-12-12 | 0 | $0.00 | 8 | $67.36 | -8 | -$67.36 | * |
| 2025-12-13 | 0 | $0.00 | 5 | $52.55 | -5 | -$52.55 | * |
| 2025-12-14 | 0 | $0.00 | 10 | $121.90 | -10 | -$121.90 | * |
| 2025-12-15 | 0 | $0.00 | 8 | $69.95 | -8 | -$69.95 | * |
| 2025-12-16 | 0 | $0.00 | 3 | $52.97 | -3 | -$52.97 | * |
| 2025-12-17 | 0 | $0.00 | 2 | $25.98 | -2 | -$25.98 | * |
| 2025-12-18 | 0 | $0.00 | 3 | $3.00 | -3 | -$3.00 | * |
| 2025-12-19 | 0 | $0.00 | 3 | $33.98 | -3 | -$33.98 | * |
| 2025-12-20 | 0 | $0.00 | 2 | $32.97 | -2 | -$32.97 | * |
| 2025-12-21 | 0 | $0.00 | 7 | $131.92 | -7 | -$131.92 | * |
| 2025-12-22 | 0 | $0.00 | 4 | $78.94 | -4 | -$78.94 | * |
| 2025-12-23 | 0 | $0.00 | 4 | $19.38 | -4 | -$19.38 | * |
| 2025-12-24 | 0 | $0.00 | 2 | $2.00 | -2 | -$2.00 | * |
| 2025-12-25 | 0 | $0.00 | 9 | $117.32 | -9 | -$117.32 | * |
| 2025-12-26 | 17 | $105.53 | 21 | $127.51 | -4 | -$21.98 | * |
| 2025-12-27 | 9 | $95.91 | 9 | $95.91 | 0 | $0.00 | OK |
| 2025-12-28 | 17 | $256.23 | 17 | $256.23 | 0 | $0.00 | OK |
| 2025-12-29 | 10 | $159.30 | 10 | $159.30 | 0 | $0.00 | OK |
| 2025-12-30 | 24 | $375.75 | 24 | $375.75 | 0 | $0.00 | OK |
| 2025-12-31 | 21 | $352.18 | 21 | $352.18 | 0 | $0.00 | OK |
| 2026-01-01 | 12 | $188.67 | 12 | $188.67 | 0 | $0.00 | OK |
| 2026-01-02 | 14 | $240.85 | 14 | $240.85 | 0 | $0.00 | OK |
| 2026-01-03 | 13 | $239.85 | 13 | $239.85 | 0 | $0.00 | OK |
| 2026-01-04 | 15 | $220.22 | 15 | $220.22 | 0 | $0.00 | OK |
| 2026-01-05 | 20 | $315.39 | 20 | $315.39 | 0 | $0.00 | OK |
| 2026-01-06 | 13 | $204.47 | 13 | $204.47 | 0 | $0.00 | OK |
| 2026-01-07 | 14 | $177.87 | 14 | $177.87 | 0 | $0.00 | OK |
| 2026-01-08 | 16 | $247.83 | 16 | $247.83 | 0 | $0.00 | OK |
| 2026-01-09 | 11 | $186.28 | 11 | $186.28 | 0 | $0.00 | OK |
| 2026-01-11 | 3 | $77.94 | 3 | $77.94 | 0 | $0.00 | OK |
| 2026-01-12 | 11 | $28.98 | 11 | $28.98 | 0 | $0.00 | OK |
| 2026-01-13 | 1 | $12.99 | 1 | $12.99 | 0 | $0.00 | OK |
| 2026-01-14 | 2 | $38.97 | 0 | $0.00 | +2 | +$38.97 | * |

---

## Key Findings

### 1. Perfect Match from Dec 27, 2025 onwards
From December 27 through January 13, 2026, the data matches **exactly** between both systems (17 consecutive days).

### 2. Missing Historical Data in Production
The production `stripe_invoices` table is missing all payments before December 26, 2025:
- **110 payments** missing
- **~$1,016 revenue** not captured
- Data exists in analytics from Stripe API ingestion

### 3. Partial Day on December 26
The production table started mid-day on December 26, 2025:
- Production: 17 payments ($105.53)
- Analytics: 21 payments ($127.51)
- Missing: 4 payments ($21.98)

### 4. Today's Data (January 14, 2026)
Production has 2 new payments ($38.97) not yet synced to analytics database.

---

## Root Cause Analysis

| Issue | Explanation |
|-------|-------------|
| **Historical Gap** | Production `stripe_invoices` table was implemented on 2025-12-26 and only captures webhook events from that point forward |
| **Analytics Source** | Analytics database pulls directly from Stripe API with full historical data |
| **Today's Lag** | Normal ETL pipeline delay - analytics will catch up on next sync |

---

## Recommendations

1. **Use Analytics as Source of Truth** - The `mart_stripe_payments` table in the analytics database contains complete historical payment data.

2. **No Backfill Needed** - The production invoices table serves a different purpose (webhook event logging). Historical data is already available in analytics.

3. **Monitor Daily Sync** - The 1-day lag for today's data is expected behavior due to ETL scheduling.

---

## Data Sources

| Source | Table | Connection |
|--------|-------|------------|
| Production | `public.stripe_invoices` | PG_PROD_* credentials |
| Analytics | `analytics.mart_stripe_payments` | PG_ANALYTICS_* credentials |

---

*Report generated by `scripts/validate_payments.py`*
