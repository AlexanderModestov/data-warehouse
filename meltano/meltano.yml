default_environment: dev
project_id: 019b8f3e-012a-7acd-916d-eae5cf93ef4b
environments:
- name: dev
- name: staging
- name: prod
plugins:
  extractors:
  - name: tap-stripe
    variant: singer-io
    pip_url: git+https://github.com/singer-io/tap-stripe.git
    config:
      account_id: ${STRIPE_ACCOUNT_ID}
      client_secret: ${STRIPE_API_KEY}
      start_date: '2024-01-01T00:00:00Z'
    select:
      - "*.*"
  - name: tap-amplitude
    variant: airbyte
    pip_url: git+https://github.com/meltanolabs/tap-airbyte-wrapper.git
    executable: tap-airbyte
    capabilities:
      - state
      - catalog
      - discover
      - about
      - stream-maps
    settings:
      - name: airbyte_config.api_key
        kind: password
      - name: airbyte_config.secret_key
        kind: password
      - name: airbyte_config.start_date
        kind: date_iso8601
      - name: airbyte_spec.image
        value: airbyte/source-amplitude
      - name: airbyte_spec.tag
        value: latest
    config:
      airbyte_config:
        api_key: ${AMPLITUDE_API_KEY}
        secret_key: ${AMPLITUDE_SECRET_KEY}
        start_date: '2025-07-01T00:00:00Z'
    select:
      - "*.*"
  - name: tap-appsflyer-ios
    inherit_from: tap-appsflyer
    config:
      api_token: ${APPSFLYER_API_TOKEN}
      app_id: ${APPSFLYER_IOS_APP_ID}
      start_date: '2025-01-01T00:00:00Z'
      organic_installs: true
  - name: tap-appsflyer-android
    inherit_from: tap-appsflyer
    config:
      api_token: ${APPSFLYER_API_TOKEN}
      app_id: ${APPSFLYER_ANDROID_APP_ID}
      start_date: '2025-01-01T00:00:00Z'
      organic_installs: true
  - name: tap-appsflyer
    variant: singer-io
    pip_url: tap-appsflyer
  - name: tap-postgres
    variant: meltanolabs
    pip_url: meltanolabs-tap-postgres
    config:
      host: ${PG_PROD_HOST}
      port: ${PG_PROD_PORT}
      user: ${PG_PROD_USER}
      password: ${PG_PROD_PASSWORD}
      database: ${PG_PROD_DBNAME}
      filter_schemas:
        - public
    select:
      # Specify which tables to sync - replace with your actual table names
       - "public-facebook_ad_accounts.*"
       - "public-facebook_ad_statistics.*"
       - "public-facebook_ads.*"
       - "public-facebook_adsets.*"
       - "public-facebook_apps.*"
       - "public-facebook_campaigns.*"
       - "public-onboarding_replies.*"
    metadata:
      '*':
        replication-method: FULL_TABLE
  mappers:
  - name: meltano-map-transformer
    variant: meltano
    pip_url: meltano-map-transform
    executable: meltano-map-transform
    mappings:
    - name: fix-amplitude-types
      config:
        stream_maps:
          events_list:
            __filter__: "False"
          "*":
            __key_properties__: []
            timeline_hidden: int(record.get('timeline_hidden')) if record.get('timeline_hidden') is not None else record.get('timeline_hidden')

  loaders:
  - name: target-postgres
    variant: meltanolabs
    pip_url: meltanolabs-target-postgres
    config:
      host: ${PG_ANALYTICS_HOST}
      port: ${PG_ANALYTICS_PORT}
      user: ${PG_ANALYTICS_USER}
      password: ${PG_ANALYTICS_PASSWORD}
      database: ${PG_ANALYTICS_DBNAME}
      default_target_schema: ${TARGET_SCHEMA}
      ssl_mode: require
      flattening_enabled: true
      flattening_max_depth: 0
      batch_size_rows: 500
      validate_records: false
      max_parallelism: 1 
